var BlogTextsWidget = {
    circleStyles: { backgroundColor: 'black', height: '50px', width: '50px', borderRadius: '50%', position: 'absolute', bottom: '15px', right: '15px', cursor: 'pointer', },
    welcome_message: 'send me a line',
    formHtml: '<%= escape_javascript render "form" %>',
    cssStyles: "<%= asset_url('tailwind.css') %>",
    thankYouHtml: '<p id="BlogTextsWidget_thank_you" class="py-4 px-4">Thanks for your message!</p>',

    init: function() {
        console.log("widget initialized!");
        this.showIcon();
        this.plantCss();
    },
    plantCss: function() {
        let stylesheet = document.createElement('link');
        stylesheet.rel = 'stylesheet';
        stylesheet.href = this.cssStyles;

        document.head.append(stylesheet);
    },
    showWidget: function() {
        document.body.insertAdjacentHTML('beforeend', this.formHtml);
        document.getElementById('new_message').addEventListener('submit', this.submitForm);

        document.getElementById('blog_text_widget_hide_form_button').addEventListener('click', this.hideWidget.bind(this));
        this.hideIcon();
    },
    hideWidget: function() {
        document.getElementById('blog_text_widget').remove();
        this.showIcon();
    },
    hideIcon: function() {
        // need to get the x button, then add event listener to trigger this function
        // actually you need to get this icon in the show form function, then trigger the event in there, which triggers this function
        document.getElementById('blog_text_icon').remove();
    },
    showThankYou: function() {
        document.getElementById('new_message').innerHTML = this.thankYouHtml;
        setTimeout(this.hideWidget.bind(this), 3000);
    },
    showIcon: function() {
        let icon = document.createElement('span');
        icon.id = 'blog_text_icon';
        icon.addEventListener('click', this.showWidget.bind(this));
        Object.assign(icon.style, this.circleStyles);

        document.body.append(icon);
    },
    submitForm: function(e) {
        e.preventDefault();
        let form = e.target;

        fetch(form.action, { 
            method: 'POST', body: new FormData(form)
         }).then((response) => {
            BlogTextsWidget.showThankYou();
         });
        
    },
};

BlogTextsWidget.init(); 